{% extends "layouts/base_auth.html" %}
{% load i18n %}
{% load allauth account socialaccount %}

{% block title %}{% trans "Sign In" %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="space-y-6">
  <div class="text-center">
    <h1 class="text-2xl font-bold">{% trans "Sign In" %}</h1>
    {% if not SOCIALACCOUNT_ONLY %}
      <p class="text-base-content/70 mt-2">
        {% blocktranslate %}Don't have an account? <a href="{{ signup_url }}" class="link link-primary">Sign up</a>{% endblocktranslate %}
      </p>
    {% endif %}
  </div>

  {% if not SOCIALACCOUNT_ONLY %}
    {% url 'account_login' as login_url %}
    <form method="post" action="{{ login_url }}" class="space-y-4">
      {% csrf_token %}
      {{ redirect_field }}

      <!-- Email -->
      <div class="form-control">
        <label class="label" for="{{ form.login.id_for_label }}">
          <span class="label-text">{% trans "Email" %}</span>
        </label>
        <input type="email" name="{{ form.login.html_name }}" class="input input-bordered w-full" placeholder="name@example.com" required>
        {% if form.login.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.login.errors|join:", " }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Password -->
      <div class="form-control">
        <label class="label" for="{{ form.password.id_for_label }}">
          <span class="label-text">{% trans "Password" %}</span>
          <a href="{% url 'account_reset_password' %}" class="label-text-alt link link-primary">{% trans "Forgot Password?" %}</a>
        </label>
        <input type="password" name="{{ form.password.html_name }}" class="input input-bordered w-full" required>
        {% if form.password.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ form.password.errors|join:", " }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Remember Me -->
      <div class="form-control">
        <label class="label cursor-pointer justify-start gap-2">
          <input type="checkbox" name="{{ form.remember.html_name }}" class="checkbox checkbox-sm checkbox-primary" {% if form.remember.value %}checked{% endif %}>
          <span class="label-text">{% trans "Remember Me" %}</span>
        </label>
      </div>

      <button type="submit" class="btn btn-primary w-full">{% trans "Sign In" %}</button>
    </form>
  {% endif %}

  {% if SOCIALACCOUNT_ENABLED %}
    {% if not SOCIALACCOUNT_ONLY %}
      <div class="divider">{% trans "or continue with" %}</div>
    {% endif %}
    
    <div class="grid grid-cols-2 gap-3">
      {% get_providers as socialaccount_providers %}
      {% for provider in socialaccount_providers %}
        {% if provider.id == "google" %}
          <a href="{% provider_login_url provider.id process=process scope=scope auth_params=auth_params %}" 
             class="btn btn-outline gap-2">
            <svg class="h-5 w-5" viewBox="0 0 24 24">
              <path fill="currentColor" d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.9 8.2,4.73 12.2,4.73C15.29,4.73 17.1,6.7 17.1,6.7L19,4.72C19,4.72 16.56,2 12.1,2C6.42,2 2.03,6.8 2.03,12C2.03,17.05 6.16,22 12.25,22C17.6,22 21.5,18.33 21.5,12.91C21.5,11.76 21.35,11.1 21.35,11.1V11.1Z" />
            </svg>
            Google
          </a>
        {% elif provider.id == "github" %}
          <a href="{% provider_login_url provider.id process=process scope=scope auth_params=auth_params %}"
             class="btn btn-outline gap-2">
            <svg class="h-5 w-5" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
            </svg>
            GitHub
          </a>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_body %}
  {{ block.super }}
  {% if PASSKEY_LOGIN_ENABLED %}
    {% include "mfa/webauthn/snippets/login_script.html" with button_id="passkey_login" %}
  {% endif %}
{% endblock %}
